/* Plugin for Cycle2; Copyright (c) 2012 M. Alsup; v20140124 */
!function(a){"use strict";a.extend(a.fn.cycle.defaults,{progressive:!1}),a(document).on("cycle-pre-initialize",function(b,c){if(c.progressive){var d,e,f,g=c.API,h=g.prepareTx,i=g.page,j=a.type(c.progressive),k=g.progressive={};if("array"==j)d=c.progressive;else if(a.isFunction(c.progressive))d=c.progressive(c);else if("string"==j){if(e=a(c.progressive),d=a.trim(e.html()),!d)return;if(/^(\[)/.test(d))try{d=a.parseJSON(d)}catch(l){return void g.log("error parsing progressive slides",l)}else d=d.split(new RegExp(e.data("cycle-split")||"\n")),d[d.length-1]||d.pop()}k.buildSlide=function(b,c){return c=c||"IMG",a("<"+c+" />").data("cycle.progressive",a.trim(b)).addClass("cycle-progressive-slide")},c.pager&&(f=c.slides.length?c.slides[0].nodeName:"",a.each(d,function(a,b){c.API.add(k.buildSlide(b,f))})),h&&(g.prepareTx=function(b,c){var d=this.opts(),e=c?d.currSlide+1:d.currSlide-1,f=a(d.slides[e]);k.navigate(f,function(a,b){return function(){h.apply(a,b)}}(d.API,[b,c]))}),i&&(g.page=function(b,c){var d=this.opts(),e=a(c).index(),f=a(d.slides[e]);k.navigate(f,function(a){return function(){d.API.jump(a)}}(e))}),k.hydrate=function(b,c){var d,e=(c.container.find(".cycle-slide").length,b.index(".cycle-slide")-1),f=a(b.data("cycle.progressive")).addClass("cycle-slide"),g=b.data("cycle.opts");return f.data("cycle.opts",g).hide(),k.replaceSlide(f[0],e,c),c.container.data("cycle.opts",c),c.container.find(".cycle-slide").eq(e+1).replaceWith(f),d=f.find("img").andSelf().filter("img"),d.length?d.load(function(){c.API.trigger("cycle-slide-hydrated",[c,g,f])}):c.API.trigger("cycle-slide-hydrated",[c,g,f]),f},k.navigate=function(a,b){a.hasClass("cycle-progressive-slide")?(c.container.one("cycle-slide-hydrated",function(a,c){b&&b(),c.container.removeClass("cycle-loading")}),c.container.addClass("cycle-loading"),k.hydrate(a,c)):b&&b()},k.replaceSlide=function(b,c,d){var e=[];a.each(d.slides,function(a,d){e.push(a===c?b:d)}),d.slides=a(e)}}})}(jQuery);